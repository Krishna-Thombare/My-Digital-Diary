{% set feature_css = 'notes' %}
{% extends "base.html" %}
{% block content %}

<div class="notes-header-section">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="d-flex align-items-center">
            <a href="{{ url_for('notes.notes_list') }}" class="notes-icon-btn">‚Üê</a>
            <span class="notes-label ms-2">Back</span>
        </div>

        <h2 class="text-center flex-grow-1 notes-title">Edit Note</h2>

        <div class="d-flex align-items-center">
            <span class="notes-label me-2">Save</span>
            <button form="editNoteForm" type="submit" class="notes-icon-btn">‚úì</button>
        </div>
    </div>
</div>

<div class="notes-diary-box">
    <form id="editNoteForm" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div class="notes-header d-flex align-items-center gap-2">
            <div class="flex-grow-1 d-flex gap-2 align-items-center">
                {{ form.note_name(class="notes-topic-input", placeholder="Title") }}

                <!-- Image Upload Button -->
                <label for="image" class="notes-image-btn">
                    {% if entry.image_filename %}
                        üì∑ Change Image
                    {% else %}
                        üì∑ Add Image
                    {% endif %}
                </label>
                <input type="file" id="image" name="image" accept="image/*" style="display: none;">
            </div>
        </div>
        <hr class="notes-line">

        <div class="notes-body">
            <!-- Current saved image -->
            {% if entry.image_filename %}
                <div id="existing-image" class="mt-3">
                    <strong>Current Image:</strong><br>
                    <img id="existing-img-tag"
                        src="{{ url_for('static', filename='uploads/' + entry.image_filename) }}"
                        style="max-width: 250px; border: 1px solid #000; padding: 4px;"
                        alt="Note Image"
                        class="note-image">

                    <!-- Remove image checkbox -->
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="remove-image" name="remove_image">
                        <label class="form-check-label" for="remove-image"> Remove this image </label>
                    </div>
                </div>
            {% endif %}

            <!-- Hidden textarea for submission -->
            <textarea name="notes" id="notes-hidden" style="display: none;"></textarea>

            <!-- Floating Image Preview -->
            <img id="image-preview" src="" alt="Image Preview" class="floating-image" style="display: none;">
            <br>
            <!-- Editable div pre-filled with existing note -->
            <div id="notes-editor" class="notes-textarea" contenteditable="true" placeholder="Edit your note...">{{ form.notes.data|safe }}</div>

            <hr class="line">

            {{ form.source_links(class="notes-textarea", rows=3, placeholder="Edit sources if any...") }}
        </div>
    </form>
</div>

<script src="{{ url_for('static', filename='js/notes_edit.js') }}"></script>

{% endblock %}
